# Test for R script util_ipd.R

get_clean_digitized_data_lung_veteran <- function() {
  time <-
    c(
      0.530035335689035,
      0.530035335689035,
      1.59010600706712,
      3.18021201413427,
      4.24028268551235,
      6.89045936395759,
      7.95053003533569,
      11.13074204947,
      11.660777385159,
      12.7208480565371,
      14.8409893992933,
      15.9010600706714,
      18.0212014134275,
      19.0812720848056,
      20.1413427561837,
      20.6713780918728,
      22.2614840989399,
      23.8515901060071,
      25.4416961130742,
      27.0318021201413
    )
  prob <- c(
    0.999998788213682,
    0.986281367088853,
    0.979420232953802,
    0.971186144919949,
    0.964325010784898,
    0.94237107805358,
    0.913562070118804,
    0.898468059736218,
    0.891606925601167,
    0.876516550577537,
    0.861424963767589,
    0.847702695497487,
    0.820841561362436,
    0.818888840417436,
    0.803797253607488,
    0.790077408910023,
    0.774987033886393,
    0.768124687965023,
    0.753031889368756,
    0.731080380210075
  )
  df <- data.frame(time = time, prob = prob)
  return(df)
}

testthat::test_that("Probability range", {
  digitized_data <- get_clean_digitized_data_lung_veteran()
  surv_time <- digitized_data[,1]
  trisk <- seq(from=0, to=25, by=5)
  testthat::expect_equal(get_lower_indices(surv_time, trisk), c(1,6,8,12,15,19))
  testthat::expect_equal(get_upper_indices(surv_time, trisk), c(5,7,11,14,18,20))
})
